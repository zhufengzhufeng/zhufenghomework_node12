<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>manger</title>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.css">
</head>

<body class="container">
    <form action="" class="form-horizontal">
        <div class="form-group">
            <label for="username" class="control-label">用户名</label>
            <input type="text" id="username" auto-compuate="none">
        </div>
        <div class="form-group">
            <label for="password">密码</label>
            <input placeholder="请输入密码" id="password">
        </div>
        <button class='btn btn-info' type='button' id='add'>提交</button>
        <button class='btn btn-warning' type='reset'>重置</button>
        <button class='btn btn-primary' onclick="update()" type='button'>确认修改</button>
    </form>
    <ul class="list-group"></ul>
    <script>
    var globalId = null;
    var li = null;

    function showList(data) {
        var str = '';
        data.forEach(function(data) {
            str += `<li class="list-group-item">
            用户名:${data.username}密码:${data.password}
            <button class='btn btn-danger pull-right btn-xs' onclick='remove(${data.id})'>删除</button>
            <button class='btn btn-danger pull-right btn-xs' onclick='show(${data.id})' id=${data.id}>修改</button>
        </li>`;
        });
        document.getElementsByTagName('ul')[0].innerHTML = str;
    }

    function getData() {
        var xml = new XMLHttpRequest();
        xml.open('GET', '/getUser', true);
        xml.responseType = 'json';
        xml.onload = function(data) {
            var data = xml.response;
            showList(data);
        }
        xml.send();
    }
    getData();
    add.addEventListener('click', function() {

        if (username.value && password.value) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/addUser', true);
            xhr.responseType = 'json';
            xhr.onload = function(data) {
                var data = xhr.response;
                showList(data);
                username.value = password.value = '';
            };
            var userObj = JSON.stringify({
                username: username.value,
                password: password.value
            });
            xhr.send(userObj);
        } else {
            alert("输点东西");
        }
    });

    function remove(id) {
        var xml = new XMLHttpRequest();
        xml.open('DELETE', '/deleteUser?id=' + id, true);
        xml.responseType = 'json';
        xml.onload = function(data) {
            var data = xml.response;
            showList(data);
        }
        xml.send();
    }

    function show(id) {
        globalId = id;
        var xml = new XMLHttpRequest();
        xml.open('GET', '/getUser', true);
        xml.responseType = 'json';
        xml.onload = function(data) {
            var data = xml.response;
            data.forEach(function(item, index) {
                if (item.id == id) {
                    username.value = item.username;
                    password.value = item.password;
                }
            });
        };
        xml.send();
    }

    function update() {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/updateUser', true);
        xhr.responseType = 'json';
        xhr.onload = function(data) {
            var data = xhr.response;
            showList(data);
            document.getElementById(globalId).parentNode.innerHTML = `
                用户名:${username.value}密码:${password.value}
                <button class='btn btn-danger pull-right btn-xs' onclick='remove(${globalId})'>删除</button>
                <button class='btn btn-danger pull-right btn-xs' onclick='show(${globalId})' id=${globalId}>修改</button>`;
            username.value = password.value = '';
        };
        var userObj = JSON.stringify({
            username: username.value,
            password: password.value,
            id: globalId
        });
        xhr.send(userObj);
    }
    </script>
</body>

</html>
